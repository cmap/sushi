---
title: "vignette_and_documentation"
author: "Ursula Widocki"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output: 
  html_document:
    toc: true
    toc_depth: 3
---

```{r, echo=FALSE, results='asis'}
cat('
<style>
  .toggle-button {
    margin-left: 10px;
    font-size: 0.8em;
    cursor: pointer;
    background: #e7e7e7;
    border: none;
    padding: 2px 6px;
    border-radius: 4px;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const headers = document.querySelectorAll("h2, h3");  // Change if needed
    headers.forEach(function(header) {
      // Create button
      const button = document.createElement("button");
      button.innerText = "Hide";
      button.className = "toggle-button";

      // Wrap all content until the next same-or-higher-level heading
      let contentWrapper = document.createElement("div");
      let next = header.nextElementSibling;
      while (next && !/^H[1-3]$/.test(next.tagName)) {
        let temp = next.nextElementSibling;
        contentWrapper.appendChild(next);
        next = temp;
      }
      header.parentNode.insertBefore(contentWrapper, next);

      // Insert button
      header.appendChild(button);

      // Toggle functionality
      button.addEventListener("click", function() {
        if (contentWrapper.style.display === "none") {
          contentWrapper.style.display = "";
          button.innerText = "Hide";
        } else {
          contentWrapper.style.display = "none";
          button.innerText = "Show";
        }
      });
    });
  });
</script>
')
```


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

# Sushi: processing PRSIM data
Sushi is a processing pipeline that converts raw barcode counts from each flow cell and flow cell lane into normalized counts and log2 fold changes (L2FCs). First, in the collate_fastq_reads step, raw counts of PRISM barcodes are aggregated across flow cells and lanes. The filter_counts module maps each barcode to its corresponding cell line or control barcode sequence, categorizing them into expected and unexpected counts and producing per-sample counts for expected cell lines and controls. The CB_normalize step then normalizes raw cell line counts using a spiked-in control barcode ladder. Next, compute_l2fc calculates L2FCs for each cell line across treatment replicates. These are further collapsed in collapse_replicates, which computes L2FCs across replicates. Dose_response models doseâ€“response curves using cell line viability (2^L2FC) for each treatment. Finally, L2FCs are analyzed to identify biomarkers through univariate and multivariate associations with DepMap data. The resulting outputs are partitioned by collaborator and shared via the PRISM Portal.


Sushi output files, their columns and definitions can be found on this spreadsheet. Columns sushi repeatedly uses to match cell line information are depmap_id, lua, pool_id, and cell_set.


## Sushi pipeline overview

## Getting started with Sushi

### From sequencing output to pre-normalized counts

## Normalizing raw counts

## Filtering based on quality control

### Measures of screen quality

### Measures of well quality

## Calculating log2 fold changes

## Collapsing log2 fold changes across replicates

## Spliting based on projects

## Identifying biomarkers

## Frequently asked questions

